<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미지의 크리처 키우기 실험실</title>
    <link href="https://fonts.googleapis.com/css2?family=Michroma&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark-overlay: rgba(0, 0, 0, 0.7); 
            --accent-glow: #00e0ff;         
            --accent-secondary: #FF6941;    
            --text-normal: #e0e0e0;         
            --text-muted: #888;             
            --shadow-glow: rgba(0, 224, 255, 0.3); 
            --shadow-dark: rgba(0, 0, 0, 0.4);     
            --gameover-red: #ff3333;
            --filter-invert: none; 
        }

        body {
            font-family: 'Roboto Mono', monospace; 
            text-align: center;
            color: var(--text-normal);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            box-sizing: border-box;
            background-image: url('background.jpg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
            z-index: 0;
            cursor: none; 
            transition: filter 0.1s ease-out;
            filter: var(--filter-invert);
            overflow: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-dark-overlay);
            z-index: 1; 
        }
        
        .content-area {
            position: relative;
            z-index: 2; 
            max-width: 500px; 
            width: 100%;
            margin: 0 auto; 
            padding-top: 0;
        }

        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            text-align: left;
            opacity: 1;
            transition: opacity 1s ease-out;
        }

        #intro-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .intro-text {
            max-width: 600px;
            width: 90%;
            margin: 0 auto;
        }
        
        .intro-text p {
            font-size: 1.1em;
            margin: 18px 0;
            opacity: 0;
            animation: fadeInText 1.5s forwards;
            animation-delay: var(--delay);
            padding: 0;
            line-height: 1.2;
        }

        .intro-text p:last-of-type {
            font-size: 1.2em;
            margin-top: 40px;
            text-align: center;
            color: var(--accent-glow);
            text-shadow: 0 0 10px var(--accent-glow);
            animation: fadeInText 1.5s forwards, blink 1.5s infinite step-end;
            animation-delay: var(--delay), calc(var(--delay) + 1.5s);
        }

        @keyframes fadeInText {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes blink {
            from, to { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .plant-display {
            width: 500px;
            height: 500px;
            background-color: transparent; 
            margin: 0 auto 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible; 
            border: none; 
            box-shadow: none;
            border-radius: 0;
            position: relative;
        }

        #plant-icon { 
            width: 100%; 
            height: 100%;
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.4s ease-out; 
            filter: drop-shadow(0 0 8px rgba(0, 224, 255, 0.5)); 
        }
        
        #plant-icon.petting-ready {
            cursor: pointer; 
        }

        @media (max-width: 500px) {
            .plant-display {
                width: 100vw; 
                height: 100vw;
                max-width: 500px; 
                max-height: 500px; 
            }
            .intro-text p {
                font-size: 0.9em;
            }
        }

        .particle {
            position: fixed;
            width: 8px; 
            height: 8px;
            background-color: var(--accent-glow); 
            border-radius: 50%;
            pointer-events: none; 
            transform: translate(-50%, -50%);
            z-index: 1000;
            opacity: 0;
            box-shadow: 0 0 8px var(--accent-glow), 0 0 12px rgba(0, 224, 255, 0.5); 
            transition: opacity 0.5s, transform 0.5s;
        }

        .action-button:hover:not(:disabled), #restart-button:hover {
            cursor: pointer; 
        }

        .status-message {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.05em;
            font-weight: 700;
            margin-top: 20px;
            margin-bottom: 15px;
            color: var(--text-normal);
            text-transform: uppercase;
        }

        .status-message.water-needed { color: var(--accent-glow); text-shadow: 0 0 3px var(--accent-glow); } 
        .status-message.good-state { color: var(--text-normal); }
        .status-message.grown { 
            color: var(--accent-secondary); 
            text-shadow: 0 0 3px var(--accent-secondary); 
        }
        .status-message.game-over { color: var(--gameover-red); text-shadow: 0 0 5px var(--gameover-red); }

        .growth-progress-bar-container {
            background-color: #333;
            border-radius: 8px;
            height: 8px; 
            margin: 15px auto;
            max-width: 400px; 
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
        }

        .growth-progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, var(--accent-glow)); 
            width: 0%;
            border-radius: 8px;
            transition: width 0.8s ease-out;
            box-shadow: 0 0 8px var(--accent-glow); 
        }

        .timer-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.85em;
            color: var(--text-muted);
            margin-top: 8px;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        
        #controls {
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }

        .action-button {
            background-color: var(--accent-glow); 
            color: black; 
            padding: 12px 25px;
            border: none;
            border-radius: 0; 
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 0 15px var(--shadow-glow); 
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .action-button:hover:not(:disabled) {
            background-color: #00c0e0;
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 224, 255, 0.5);
        }

        .action-button:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: 0 0 10px var(--shadow-glow);
        }

        .action-button:disabled {
            background-color: #555;
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
            filter: grayscale(100%); 
        }
        
        #restart-button {
            background-color: var(--gameover-red);
            border-radius: 0px; 
            box-shadow: 0 0 15px var(--gameover-red);
            color: white;
            font-size: 1.2em;
        }
        #restart-button:hover {
            background-color: #e02222;
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
        }
    </style>
</head>
<body>
    
    <audio id="background-music" src="bgm33.mp3" autoplay loop></audio>

    
    <div id="intro-screen">
        <div class="intro-text">
            <p style="--delay: 0.0s;">연구 기록 ◼◼◼</p>
            <p style="--delay: 1.0s;">채집 위치: 폐허 내부, 이상 섬광 발생 지점</p>
            <p style="--delay: 2.0s;">관찰 일시: [기록 생략]</p>
            <p style="--delay: 3.0s;">섬광 소멸 직후, 현장에서 미확인 씨앗 개체 1기를 채취함.</p>
            <p style="--delay: 4.0s;">표면은 매끄럽고 타원형에 가까우며, 독특한 무늬가 관찰됨. 불규칙한 주기로 미약한 발광 반응을 보임. 광원은 외부 반사광이 아닌 내부 기원의 자가 발광으로 추정됨.</p>
            <p style="--delay: 5.0s;">접촉 시 단순 진동이 아닌 맥동 형태의 반응이 피부를 통해 감지됨.</p>
            <p style="--delay: 7.0s;">처리 방안 검토:</p>
            <p style="--delay: 8.0s;">즉시 폐기 — 기원 불명, 위험 요인 제거 목적.</p>
            <p style="--delay: 9.0s;">격리 보관 — 장기적 관찰을 통한 안전성 평가.</p>
            <p style="--delay: 10.0s;">제한적 육성 — 성장 과정을 기록, 기원 규명 시도.</p>
            <p style="--delay: 11.0s;">최종 결론: [ 육성 개시 ]</p>
            <p style="--delay: 12.0s;">사유: 개체가 지닌 잠재적 가치(비정상적 에너지 반응, 미지 생명체 가능성) 확인 필요.</p>
            <p style="--delay: 15.0s;">부록: 이는 일반적인 종자가 아닐 수 있음.</p>
            
            <p style="--delay: 16.0s;">[ 기록을 클릭하여 실험을 시작하세요... ]</p>
        </div>
    </div>

    
    <div id="game-content" style="display:none;">
        <div class="content-area">
            
            <div class="plant-display">
                <div id="plant-icon"></div>
            </div>
            
            <p id="status-message" class="status-message water-needed">영양 공급이 필요하다</p>
            
            <div class="growth-progress-bar-container">
                <div id="growth-progress-bar" class="growth-progress-bar" style="width:0%;"></div>
            </div>
            <p id="growth-timer-display" class="timer-display"></p>

            <div id="controls">
                <button id="water-button" class="action-button">💉 영양 주입</button>
                <button id="restart-button" class="action-button" style="display:none;">클론으로 재시도</button>
                <p id="water-cooldown" class="timer-display" style="display:none;"></p>
            </div>
        </div>
    </div>

    <script>
        const CREATURE_IMAGES = [
            './img/creature_stage0_seed.png',    
            './img/creature_stage1_sprout.png',  
            './img/creature_stage2_small.png',   
            './img/creature_stage3_medium.png',  
            './img/creature_stage4_full.png'     
        ];

        const DIALOGUES = [
            '날 당신이 키운거야?',
            '너무 갑갑해.',
            '놀아줄 수 있어?',
            '나가고싶어.',
            '말 좀 해봐.',
            '영양제 말고 <span style="color: #FF0000;">다른 것</span> 먹고싶어.',
            '심심해.',
            '어딜 가려고?',
            '날 어디서 찾은건데?',
        ];

        const NUTRIENT_SHORTAGE_IMAGE = './img/nutrient_splash.png';
        const NUTRIENT_SHORTAGE_WARNING_TIME = 8000; 
        const GROWTH_INTERVAL_MS = 10000; 
        const FEED_COOLDOWN_MS = 5000;    
        
        const PARTICLE_COUNT = 25;
        const particles = [];

        let currentStage = 0;      
        let feedNeeded = true;     
        let growthTimerInterval;    
        let growthTimeElapsed = 0;  

        let nutrientShortageTimer;
        let isShortageDisplayed = false; 
        let isGameOver = false; 

        const introScreen = document.getElementById('intro-screen'); 
        const gameContent = document.getElementById('game-content'); 
        const creatureIcon = document.getElementById('plant-icon'); 
        const statusMessage = document.getElementById('status-message');
        const feedButton = document.getElementById('water-button'); 
        const restartButton = document.getElementById('restart-button'); 
        const cooldownDisplay = document.getElementById('water-cooldown'); 
        const timerDisplay = document.getElementById('growth-timer-display');
        const growthProgressBar = document.getElementById('growth-progress-bar');
        const bgm = document.getElementById('background-music');
        
        let originalFeedListener = null;

        function showRandomDialogue() {
            const dialogue = DIALOGUES[Math.floor(Math.random() * DIALOGUES.length)];
            const textElement = document.createElement('div');
            const plantDisplay = document.querySelector('.plant-display');
            
            textElement.style.cssText = `
                position: absolute; 
                color: white;
                font-size: 1.5em;
                font-weight: 700;
                font-family: 'Roboto Mono', monospace;
                text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
                opacity: 1;
                transition: opacity 1.5s ease-out, transform 1.5s ease-out;
                pointer-events: none;
                white-space: nowrap; 
                z-index: 500;
                filter: invert(0) hue-rotate(0deg); 
            `;

            const randomX = 50 + (Math.random() * 20 - 10); 
            const randomY = 25 + (Math.random() * 20 - 10); 
            
            textElement.style.left = `${randomX}%`;
            textElement.style.top = `${randomY}%`;
            textElement.style.transform = 'translate(-50%, -50%)';
            
            textElement.innerHTML = dialogue.replace(/\*(.*?)\*/g, '<span style="color: var(--accent-secondary); font-style: italic;">$1</span>');
            
            plantDisplay.appendChild(textElement); 

            setTimeout(() => {
                textElement.style.opacity = '0';
                textElement.style.transform = 'translate(-50%, -70%)';
            }, 100);

            setTimeout(() => {
                textElement.remove();
            }, 1600);
        }
        
        function initializeCursorParticles() {
            document.querySelectorAll('.particle').forEach(p => p.remove());
            particles.length = 0;
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                document.body.appendChild(particle);
                particles.push({
                    element: particle, x: 0, y: 0,
                    targetX: 0, targetY: 0,
                    delay: i * 0.05 
                });
            }
            document.addEventListener('mousemove', (e) => {
                particles[0].targetX = e.clientX;
                particles[0].targetY = e.clientY;
                for (let i = 1; i < PARTICLE_COUNT; i++) {
                    particles[i].targetX = particles[i-1].x;
                    particles[i].targetY = particles[i-1].y;
                }
            });
        }

        function updateCreatureDisplay() {
            if (isShortageDisplayed || isGameOver) { return; }
            creatureIcon.style.backgroundImage = `url('${CREATURE_IMAGES[currentStage]}')`;
            creatureIcon.style.transform = 'scale(1.1)';
            setTimeout(() => { creatureIcon.style.transform = 'scale(1.0)'; }, 300);
        }

        function handleGameOver() {
            isGameOver = true;
            clearInterval(growthTimerInterval);
            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);

            creatureIcon.style.backgroundImage = `url('${NUTRIENT_SHORTAGE_IMAGE}')`;
            isShortageDisplayed = true;
            
            statusMessage.textContent = '결론: 실험 실패 — 개체 소멸';
            statusMessage.classList.remove('water-needed', 'good-state', 'grown');
            statusMessage.classList.add('game-over'); 

            feedButton.style.display = 'none';
            cooldownDisplay.style.display = 'none'; 
            restartButton.style.display = 'inline-block';
            timerDisplay.textContent = '';
            growthProgressBar.style.width = '0%';
            
            creatureIcon.removeEventListener('click', handlePetting);
            creatureIcon.classList.remove('petting-ready');
        }
        
        function restoreCreatureImage() {
            creatureIcon.style.backgroundImage = `url('${CREATURE_IMAGES[currentStage]}')`;
            isShortageDisplayed = false;
        }

        function updateStatusMessage() {
            if (isGameOver) return; 

            statusMessage.classList.remove('water-needed', 'good-state', 'grown', 'game-over'); 

            if (currentStage === CREATURE_IMAGES.length - 1) {
                statusMessage.textContent = '생명체가 다 자란 것 같다. 만져보자.';
                statusMessage.classList.add('grown');
                
            } else if (feedNeeded) {
                statusMessage.textContent = '영양 공급이 필요하다';
                statusMessage.classList.add('water-needed'); 
                feedButton.textContent = '💉 영양 주입';
                
            } else {
                statusMessage.textContent = '상태가 좋아보인다.';
                statusMessage.classList.add('good-state'); 
                feedButton.textContent = '💉 영양 주입';
            }
        }

        function transitionToPetting() {
            feedButton.style.display = 'none';
            cooldownDisplay.style.display = 'none';
            
            updateStatusMessage(); 

            if (originalFeedListener) {
                feedButton.removeEventListener('click', originalFeedListener);
            }
            feedButton.removeEventListener('click', ensureBgmPlays); 
            
            creatureIcon.removeEventListener('click', handlePetting); 
            creatureIcon.addEventListener('click', handlePetting);
            creatureIcon.classList.add('petting-ready');
        }

        function handlePetting() { 
            statusMessage.textContent = '목소리가 머릿속으로 흘러들어온다.';
            
            showRandomDialogue(); 
            ensureBgmPlays(); 
            
            document.body.style.filter = 'invert(100%) hue-rotate(180deg)';
            
            setTimeout(() => {
                document.body.style.filter = 'none';
            }, 800);
            
            creatureIcon.style.transition = 'transform 0.1s ease-in-out';
            creatureIcon.style.transform = 'scale(1.02) rotate(-1deg)'; 
            
            setTimeout(() => {
                creatureIcon.style.transform = 'scale(1.0) rotate(0deg)';
                creatureIcon.style.transition = 'transform 0.4s ease-out';
                updateStatusMessage(); 
            }, 300);
        }

        function growCreature() { 
            if (isGameOver) return;

            if (currentStage < CREATURE_IMAGES.length - 1) {
                currentStage++;
                if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
                startNutrientShortageTimer(); 
                restoreCreatureImage();
                updateCreatureDisplay();
                updateStatusMessage();
                growthTimeElapsed = 0; 
                growthProgressBar.style.width = '0%'; 
                
                feedButton.style.display = 'block'; 
                
            } else {
                clearInterval(growthTimerInterval);
                if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
                timerDisplay.textContent = '더 이상 자라지 않는 것 같다.';
                
                transitionToPetting(); 
            }
        }

        function handleFeeding() { 
            if (feedButton.disabled || isGameOver) return; 
            
            if (currentStage === CREATURE_IMAGES.length - 1) return; 

            feedNeeded = false;
            updateStatusMessage(); 

            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
            restoreCreatureImage();
            updateCreatureDisplay(); 

            feedButton.disabled = true;
            
            let timeRemaining = FEED_COOLDOWN_MS / 1000;
            cooldownDisplay.textContent = `재사용까지 ${timeRemaining}초...`;
            cooldownDisplay.style.display = 'block'; 

            const cooldownInterval = setInterval(() => {
                timeRemaining--;
                cooldownDisplay.textContent = `재사용까지 ${timeRemaining}초...`;
                if (timeRemaining <= 0) {
                    clearInterval(cooldownInterval);
                    feedButton.disabled = false; 
                    feedNeeded = true; 
                    cooldownDisplay.textContent = '';
                    cooldownDisplay.style.display = 'none'; 
                    updateStatusMessage();
                    
                    if (currentStage < CREATURE_IMAGES.length - 1) {
                            startNutrientShortageTimer();
                    }
                }
            }, 1000);
        }

        function startNutrientShortageTimer() {
            if (isGameOver) return;

            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);

            nutrientShortageTimer = setTimeout(() => {
                if (feedNeeded && currentStage < CREATURE_IMAGES.length - 1) {
                    handleGameOver(); 
                }
            }, NUTRIENT_SHORTAGE_WARNING_TIME);
        }

        function restartGame() {
            document.body.style.filter = 'none'; 
            if (bgm) bgm.pause(); 
            window.location.reload(); 
        }

        function ensureBgmPlays() {
            if (bgm && bgm.paused) {
                bgm.play().catch(error => {});
            }
        }

        function startGame() {
            introScreen.classList.add('fade-out');
            setTimeout(() => {
                introScreen.style.display = 'none';
                gameContent.style.display = 'block';
                initialize();
                ensureBgmPlays();
            }, 1000); 
        }

        function initialize() {
            if (growthTimerInterval) clearInterval(growthTimerInterval);
            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
            
            updateCreatureDisplay();
            updateStatusMessage();
            timerDisplay.textContent = `다음 진화까지 ${GROWTH_INTERVAL_MS / 1000}초 남음`; 
            
            feedButton.style.display = 'block'; 
            cooldownDisplay.style.display = 'none';
            document.body.style.filter = 'none'; 

            startNutrientShortageTimer();
            initializeCursorParticles(); 
            
            function updateParticles() {
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    const p = particles[i];
                    p.x += (p.targetX - p.x) * 0.3; 
                    p.y += (p.targetY - p.y) * 0.3;
                    p.element.style.left = `${p.x}px`;
                    p.element.style.top = `${p.y}px`;
                    const distance = Math.sqrt(Math.pow(p.x - particles[0].targetX, 2) + Math.pow(p.y - particles[0].targetY, 2));
                    p.element.style.opacity = distance < 120 ? 0.8 : 0; 
                    p.element.style.transform = `scale(${1 - distance / 120})`; 
                }
                requestAnimationFrame(updateParticles);
            }
            requestAnimationFrame(updateParticles); 


            growthTimerInterval = setInterval(() => {
                if (isGameOver || currentStage === CREATURE_IMAGES.length - 1) {
                    clearInterval(growthTimerInterval);
                    if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
                    
                    if (currentStage === CREATURE_IMAGES.length - 1) {
                        transitionToPetting();
                    }
                    return;
                }

                growthTimeElapsed += 1000; 
                
                const growthProgress = (growthTimeElapsed / GROWTH_INTERVAL_MS) * 100;
                growthProgressBar.style.width = `${growthProgress}%`;

                const timeLeft = (GROWTH_INTERVAL_MS - growthTimeElapsed) / 1000;
                timerDisplay.textContent = `다음 진화까지 ${timeLeft}초 남음`; 

                if (growthTimeElapsed >= GROWTH_INTERVAL_MS) {
                    growCreature(); 
                    growthTimeElapsed = 0; 
                }
            }, 1000); 

            if (!originalFeedListener) {
                originalFeedListener = handleFeeding;
                feedButton.addEventListener('click', originalFeedListener); 
                feedButton.addEventListener('click', ensureBgmPlays); 
                restartButton.addEventListener('click', restartGame); 
            }
            
            creatureIcon.removeEventListener('click', handlePetting);
        }

        introScreen.addEventListener('click', startGame);
    </script>
</body>
</html>