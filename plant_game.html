<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ì§€ì˜ í¬ë¦¬ì²˜ í‚¤ìš°ê¸° ì‹¤í—˜ì‹¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Michroma&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark-overlay: rgba(0, 0, 0, 0.7); 
            --accent-glow: #00e0ff;         
            --accent-secondary: #FF6941;    
            --text-normal: #e0e0e0;         
            --text-muted: #888;             
            --shadow-glow: rgba(0, 224, 255, 0.3); 
            --shadow-dark: rgba(0, 0, 0, 0.4);     
            --gameover-red: #ff3333;
            --filter-invert: none; 
        }

        body {
            font-family: 'Roboto Mono', monospace; 
            text-align: center;
            color: var(--text-normal);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            box-sizing: border-box;
            background-image: url('background.jpg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
            z-index: 0;
            cursor: none; 
            transition: filter 0.1s ease-out;
            filter: var(--filter-invert);
            overflow: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-dark-overlay);
            z-index: 1; 
        }
        
        .content-area {
            position: relative;
            z-index: 2; 
            max-width: 500px; 
            width: 100%;
            margin: 0 auto; 
            padding-top: 0;
        }

        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            text-align: left;
            opacity: 1;
            transition: opacity 1s ease-out;
        }

        #intro-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .intro-text {
            max-width: 600px;
            width: 90%;
            margin: 0 auto;
        }
        
        .intro-text p {
            font-size: 1.1em;
            margin: 18px 0;
            opacity: 0;
            animation: fadeInText 1.5s forwards;
            animation-delay: var(--delay);
            padding: 0;
            line-height: 1.2;
        }

        .intro-text p:last-of-type {
            font-size: 1.2em;
            margin-top: 40px;
            text-align: center;
            color: var(--accent-glow);
            text-shadow: 0 0 10px var(--accent-glow);
            animation: fadeInText 1.5s forwards, blink 1.5s infinite step-end;
            animation-delay: var(--delay), calc(var(--delay) + 1.5s);
        }

        @keyframes fadeInText {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes blink {
            from, to { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .plant-display {
            width: 500px;
            height: 500px;
            background-color: transparent; 
            margin: 0 auto 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible; 
            border: none; 
            box-shadow: none;
            border-radius: 0;
            position: relative;
        }

        #plant-icon { 
            width: 100%; 
            height: 100%;
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.4s ease-out; 
            filter: drop-shadow(0 0 8px rgba(0, 224, 255, 0.5)); 
        }
        
        #plant-icon.petting-ready {
            cursor: pointer; 
        }

        @media (max-width: 500px) {
            .plant-display {
                width: 100vw; 
                height: 100vw;
                max-width: 500px; 
                max-height: 500px; 
            }
            .intro-text p {
                font-size: 0.9em;
            }
        }

        .particle {
            position: fixed;
            width: 8px; 
            height: 8px;
            background-color: var(--accent-glow); 
            border-radius: 50%;
            pointer-events: none; 
            transform: translate(-50%, -50%);
            z-index: 1000;
            opacity: 0;
            box-shadow: 0 0 8px var(--accent-glow), 0 0 12px rgba(0, 224, 255, 0.5); 
            transition: opacity 0.5s, transform 0.5s;
        }

        .action-button:hover:not(:disabled), #restart-button:hover {
            cursor: pointer; 
        }

        .status-message {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.05em;
            font-weight: 700;
            margin-top: 20px;
            margin-bottom: 15px;
            color: var(--text-normal);
            text-transform: uppercase;
        }

        .status-message.water-needed { color: var(--accent-glow); text-shadow: 0 0 3px var(--accent-glow); } 
        .status-message.good-state { color: var(--text-normal); }
        .status-message.grown { 
            color: var(--accent-secondary); 
            text-shadow: 0 0 3px var(--accent-secondary); 
        }
        .status-message.game-over { color: var(--gameover-red); text-shadow: 0 0 5px var(--gameover-red); }

        .growth-progress-bar-container {
            background-color: #333;
            border-radius: 8px;
            height: 8px; 
            margin: 15px auto;
            max-width: 400px; 
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
        }

        .growth-progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, var(--accent-glow)); 
            width: 0%;
            border-radius: 8px;
            transition: width 0.8s ease-out;
            box-shadow: 0 0 8px var(--accent-glow); 
        }

        .timer-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.85em;
            color: var(--text-muted);
            margin-top: 8px;
            letter-spacing: 0.5px;
            margin-bottom: 25px;
        }
        
        #controls {
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }

        .action-button {
            background-color: var(--accent-glow); 
            color: black; 
            padding: 12px 25px;
            border: none;
            border-radius: 0; 
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 0 15px var(--shadow-glow); 
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .action-button:hover:not(:disabled) {
            background-color: #00c0e0;
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 224, 255, 0.5);
        }

        .action-button:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: 0 0 10px var(--shadow-glow);
        }

        .action-button:disabled {
            background-color: #555;
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
            filter: grayscale(100%); 
        }
        
        #restart-button {
            background-color: var(--gameover-red);
            border-radius: 0px; 
            box-shadow: 0 0 15px var(--gameover-red);
            color: white;
            font-size: 1.2em;
        }
        #restart-button:hover {
            background-color: #e02222;
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
        }
    </style>
</head>
<body>
    
    <audio id="background-music" src="bgm33.mp3" autoplay loop></audio>

    
    <div id="intro-screen">
        <div class="intro-text">
            <p style="--delay: 0.0s;">ì—°êµ¬ ê¸°ë¡ â—¼â—¼â—¼</p>
            <p style="--delay: 1.0s;">ì±„ì§‘ ìœ„ì¹˜: íí—ˆ ë‚´ë¶€, ì´ìƒ ì„¬ê´‘ ë°œìƒ ì§€ì </p>
            <p style="--delay: 2.0s;">ê´€ì°° ì¼ì‹œ: [ê¸°ë¡ ìƒëµ]</p>
            <p style="--delay: 3.0s;">ì„¬ê´‘ ì†Œë©¸ ì§í›„, í˜„ì¥ì—ì„œ ë¯¸í™•ì¸ ì”¨ì•— ê°œì²´ 1ê¸°ë¥¼ ì±„ì·¨í•¨.</p>
            <p style="--delay: 4.0s;">í‘œë©´ì€ ë§¤ë„ëŸ½ê³  íƒ€ì›í˜•ì— ê°€ê¹Œìš°ë©°, ë…íŠ¹í•œ ë¬´ëŠ¬ê°€ ê´€ì°°ë¨. ë¶ˆê·œì¹™í•œ ì£¼ê¸°ë¡œ ë¯¸ì•½í•œ ë°œê´‘ ë°˜ì‘ì„ ë³´ì„. ê´‘ì›ì€ ì™¸ë¶€ ë°˜ì‚¬ê´‘ì´ ì•„ë‹Œ ë‚´ë¶€ ê¸°ì›ì˜ ìê°€ ë°œê´‘ìœ¼ë¡œ ì¶”ì •ë¨.</p>
            <p style="--delay: 5.0s;">ì ‘ì´‰ ì‹œ ë‹¨ìˆœ ì§„ë™ì´ ì•„ë‹Œ ë§¥ë™ í˜•íƒœì˜ ë°˜ì‘ì´ í”¼ë¶€ë¥¼ í†µí•´ ê°ì§€ë¨.</p>
            <p style="--delay: 7.0s;">ì²˜ë¦¬ ë°©ì•ˆ ê²€í† :</p>
            <p style="--delay: 8.0s;">ì¦‰ì‹œ íê¸° â€” ê¸°ì› ë¶ˆëª…, ìœ„í—˜ ìš”ì¸ ì œê±° ëª©ì .</p>
            <p style="--delay: 9.0s;">ê²©ë¦¬ ë³´ê´€ â€” ì¥ê¸°ì  ê´€ì°°ì„ í†µí•œ ì•ˆì „ì„± í‰ê°€.</p>
            <p style="--delay: 10.0s;">ì œí•œì  ìœ¡ì„± â€” ì„±ì¥ ê³¼ì •ì„ ê¸°ë¡, ê¸°ì› ê·œëª… ì‹œë„.</p>
            <p style="--delay: 11.0s;">ìµœì¢… ê²°ë¡ : [ ìœ¡ì„± ê°œì‹œ ]</p>
            <p style="--delay: 12.0s;">ì‚¬ìœ : ê°œì²´ê°€ ì§€ë‹Œ ì ì¬ì  ê°€ì¹˜(ë¹„ì •ìƒì  ì—ë„ˆì§€ ë°˜ì‘, ë¯¸ì§€ ìƒëª…ì²´ ê°€ëŠ¥ì„±) í™•ì¸ í•„ìš”.</p>
            <p style="--delay: 15.0s;">ë¶€ë¡: ì´ëŠ” ì¼ë°˜ì ì¸ ì¢…ìê°€ ì•„ë‹ ìˆ˜ ìˆìŒ.</p>
            
            <p style="--delay: 16.0s;">[ ê¸°ë¡ì„ í´ë¦­í•˜ì—¬ ì‹¤í—˜ì„ ì‹œì‘í•˜ì„¸ìš”... ]</p>
        </div>
    </div>

    
    <div id="game-content" style="display:none;">
        <div class="content-area">
            
            <div class="plant-display">
                <div id="plant-icon"></div>
            </div>
            
            <p id="status-message" class="status-message water-needed">ì˜ì–‘ ê³µê¸‰ì´ í•„ìš”í•˜ë‹¤</p>
            
            <div class="growth-progress-bar-container">
                <div id="growth-progress-bar" class="growth-progress-bar" style="width:0%;"></div>
            </div>
            <p id="growth-timer-display" class="timer-display"></p>

            <div id="controls">
                <button id="water-button" class="action-button">ğŸ’‰ ì˜ì–‘ ì£¼ì…</button>
                <button id="restart-button" class="action-button" style="display:none;">í´ë¡ ìœ¼ë¡œ ì¬ì‹œë„</button>
                <p id="water-cooldown" class="timer-display" style="display:none;"></p>
            </div>
        </div>
    </div>

    <script>
        const CREATURE_IMAGES = [
            './img/creature_stage0_seed.png',    
            './img/creature_stage1_sprout.png',  
            './img/creature_stage2_small.png',   
            './img/creature_stage3_medium.png',  
            './img/creature_stage4_full.png'     
        ];

        const DIALOGUES = [
            'ë‚  ë‹¹ì‹ ì´ í‚¤ìš´ê±°ì•¼?',
            'ë„ˆë¬´ ê°‘ê°‘í•´.',
            'ë†€ì•„ì¤„ ìˆ˜ ìˆì–´?',
            'ë‚˜ê°€ê³ ì‹¶ì–´.',
            'ë§ ì¢€ í•´ë´.',
            'ì˜ì–‘ì œ ë§ê³  <span style="color: #FF0000;">ë‹¤ë¥¸ ê²ƒ</span> ë¨¹ê³ ì‹¶ì–´.',
            'ì‹¬ì‹¬í•´.',
            'ì–´ë”œ ê°€ë ¤ê³ ?',
            'ë‚  ì–´ë””ì„œ ì°¾ì€ê±´ë°?',
        ];

        const NUTRIENT_SHORTAGE_IMAGE = './img/nutrient_splash.png';
        const NUTRIENT_SHORTAGE_WARNING_TIME = 8000; 
        const GROWTH_INTERVAL_MS = 10000; 
        const FEED_COOLDOWN_MS = 5000;    
        
        const PARTICLE_COUNT = 25;
        const particles = [];

        let currentStage = 0;      
        let feedNeeded = true;     
        let growthTimerInterval;    
        let growthTimeElapsed = 0;  

        let nutrientShortageTimer;
        let isShortageDisplayed = false; 
        let isGameOver = false; 

        const introScreen = document.getElementById('intro-screen'); 
        const gameContent = document.getElementById('game-content'); 
        const creatureIcon = document.getElementById('plant-icon'); 
        const statusMessage = document.getElementById('status-message');
        const feedButton = document.getElementById('water-button'); 
        const restartButton = document.getElementById('restart-button'); 
        const cooldownDisplay = document.getElementById('water-cooldown'); 
        const timerDisplay = document.getElementById('growth-timer-display');
        const growthProgressBar = document.getElementById('growth-progress-bar');
        const bgm = document.getElementById('background-music');
        
        let originalFeedListener = null;

        function showRandomDialogue() {
            const dialogue = DIALOGUES[Math.floor(Math.random() * DIALOGUES.length)];
            const textElement = document.createElement('div');
            const plantDisplay = document.querySelector('.plant-display');
            
            textElement.style.cssText = `
                position: absolute; 
                color: white;
                font-size: 1.5em;
                font-weight: 700;
                font-family: 'Roboto Mono', monospace;
                text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
                opacity: 1;
                transition: opacity 1.5s ease-out, transform 1.5s ease-out;
                pointer-events: none;
                white-space: nowrap; 
                z-index: 500;
                filter: invert(0) hue-rotate(0deg); 
            `;

            const randomX = 50 + (Math.random() * 20 - 10); 
            const randomY = 25 + (Math.random() * 20 - 10); 
            
            textElement.style.left = `${randomX}%`;
            textElement.style.top = `${randomY}%`;
            textElement.style.transform = 'translate(-50%, -50%)';
            
            textElement.innerHTML = dialogue.replace(/\*(.*?)\*/g, '<span style="color: var(--accent-secondary); font-style: italic;">$1</span>');
            
            plantDisplay.appendChild(textElement); 

            setTimeout(() => {
                textElement.style.opacity = '0';
                textElement.style.transform = 'translate(-50%, -70%)';
            }, 100);

            setTimeout(() => {
                textElement.remove();
            }, 1600);
        }
        
        function initializeCursorParticles() {
            document.querySelectorAll('.particle').forEach(p => p.remove());
            particles.length = 0;
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                document.body.appendChild(particle);
                particles.push({
                    element: particle, x: 0, y: 0,
                    targetX: 0, targetY: 0,
                    delay: i * 0.05 
                });
            }
            document.addEventListener('mousemove', (e) => {
                particles[0].targetX = e.clientX;
                particles[0].targetY = e.clientY;
                for (let i = 1; i < PARTICLE_COUNT; i++) {
                    particles[i].targetX = particles[i-1].x;
                    particles[i].targetY = particles[i-1].y;
                }
            });
        }

        function updateCreatureDisplay() {
            if (isShortageDisplayed || isGameOver) { return; }
            creatureIcon.style.backgroundImage = `url('${CREATURE_IMAGES[currentStage]}')`;
            creatureIcon.style.transform = 'scale(1.1)';
            setTimeout(() => { creatureIcon.style.transform = 'scale(1.0)'; }, 300);
        }

        function handleGameOver() {
            isGameOver = true;
            clearInterval(growthTimerInterval);
            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);

            creatureIcon.style.backgroundImage = `url('${NUTRIENT_SHORTAGE_IMAGE}')`;
            isShortageDisplayed = true;
            
            statusMessage.textContent = 'ê²°ë¡ : ì‹¤í—˜ ì‹¤íŒ¨ â€” ê°œì²´ ì†Œë©¸';
            statusMessage.classList.remove('water-needed', 'good-state', 'grown');
            statusMessage.classList.add('game-over'); 

            feedButton.style.display = 'none';
            cooldownDisplay.style.display = 'none'; 
            restartButton.style.display = 'inline-block';
            timerDisplay.textContent = '';
            growthProgressBar.style.width = '0%';
            
            creatureIcon.removeEventListener('click', handlePetting);
            creatureIcon.classList.remove('petting-ready');
        }
        
        function restoreCreatureImage() {
            creatureIcon.style.backgroundImage = `url('${CREATURE_IMAGES[currentStage]}')`;
            isShortageDisplayed = false;
        }

        function updateStatusMessage() {
            if (isGameOver) return; 

            statusMessage.classList.remove('water-needed', 'good-state', 'grown', 'game-over'); 

            if (currentStage === CREATURE_IMAGES.length - 1) {
                statusMessage.textContent = 'ìƒëª…ì²´ê°€ ë‹¤ ìë€ ê²ƒ ê°™ë‹¤. ë§Œì ¸ë³´ì.';
                statusMessage.classList.add('grown');
                
            } else if (feedNeeded) {
                statusMessage.textContent = 'ì˜ì–‘ ê³µê¸‰ì´ í•„ìš”í•˜ë‹¤';
                statusMessage.classList.add('water-needed'); 
                feedButton.textContent = 'ğŸ’‰ ì˜ì–‘ ì£¼ì…';
                
            } else {
                statusMessage.textContent = 'ìƒíƒœê°€ ì¢‹ì•„ë³´ì¸ë‹¤.';
                statusMessage.classList.add('good-state'); 
                feedButton.textContent = 'ğŸ’‰ ì˜ì–‘ ì£¼ì…';
            }
        }

        function transitionToPetting() {
            feedButton.style.display = 'none';
            cooldownDisplay.style.display = 'none';
            
            updateStatusMessage(); 

            if (originalFeedListener) {
                feedButton.removeEventListener('click', originalFeedListener);
            }
            feedButton.removeEventListener('click', ensureBgmPlays); 
            
            creatureIcon.removeEventListener('click', handlePetting); 
            creatureIcon.addEventListener('click', handlePetting);
            creatureIcon.classList.add('petting-ready');
        }

        function handlePetting() { 
            statusMessage.textContent = 'ëª©ì†Œë¦¬ê°€ ë¨¸ë¦¿ì†ìœ¼ë¡œ í˜ëŸ¬ë“¤ì–´ì˜¨ë‹¤.';
            
            showRandomDialogue(); 
            ensureBgmPlays(); 
            
            document.body.style.filter = 'invert(100%) hue-rotate(180deg)';
            
            setTimeout(() => {
                document.body.style.filter = 'none';
            }, 800);
            
            creatureIcon.style.transition = 'transform 0.1s ease-in-out';
            creatureIcon.style.transform = 'scale(1.02) rotate(-1deg)'; 
            
            setTimeout(() => {
                creatureIcon.style.transform = 'scale(1.0) rotate(0deg)';
                creatureIcon.style.transition = 'transform 0.4s ease-out';
                updateStatusMessage(); 
            }, 300);
        }

        function growCreature() { 
            if (isGameOver) return;

            if (currentStage < CREATURE_IMAGES.length - 1) {
                currentStage++;
                if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
                startNutrientShortageTimer(); 
                restoreCreatureImage();
                updateCreatureDisplay();
                updateStatusMessage();
                growthTimeElapsed = 0; 
                growthProgressBar.style.width = '0%'; 
                
                feedButton.style.display = 'block'; 
                
            } else {
                clearInterval(growthTimerInterval);
                if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
                timerDisplay.textContent = 'ë” ì´ìƒ ìë¼ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤.';
                
                transitionToPetting(); 
            }
        }

        function handleFeeding() { 
            if (feedButton.disabled || isGameOver) return; 
            
            if (currentStage === CREATURE_IMAGES.length - 1) return; 

            feedNeeded = false;
            updateStatusMessage(); 

            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
            restoreCreatureImage();
            updateCreatureDisplay(); 

            feedButton.disabled = true;
            
            let timeRemaining = FEED_COOLDOWN_MS / 1000;
            cooldownDisplay.textContent = `ì¬ì‚¬ìš©ê¹Œì§€ ${timeRemaining}ì´ˆ...`;
            cooldownDisplay.style.display = 'block'; 

            const cooldownInterval = setInterval(() => {
                timeRemaining--;
                cooldownDisplay.textContent = `ì¬ì‚¬ìš©ê¹Œì§€ ${timeRemaining}ì´ˆ...`;
                if (timeRemaining <= 0) {
                    clearInterval(cooldownInterval);
                    feedButton.disabled = false; 
                    feedNeeded = true; 
                    cooldownDisplay.textContent = '';
                    cooldownDisplay.style.display = 'none'; 
                    updateStatusMessage();
                    
                    if (currentStage < CREATURE_IMAGES.length - 1) {
                            startNutrientShortageTimer();
                    }
                }
            }, 1000);
        }

        function startNutrientShortageTimer() {
            if (isGameOver) return;

            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);

            nutrientShortageTimer = setTimeout(() => {
                if (feedNeeded && currentStage < CREATURE_IMAGES.length - 1) {
                    handleGameOver(); 
                }
            }, NUTRIENT_SHORTAGE_WARNING_TIME);
        }

        function restartGame() {
            document.body.style.filter = 'none'; 
            if (bgm) bgm.pause(); 
            window.location.reload(); 
        }

        function ensureBgmPlays() {
            if (bgm && bgm.paused) {
                bgm.play().catch(error => {});
            }
        }

        function startGame() {
            introScreen.classList.add('fade-out');
            setTimeout(() => {
                introScreen.style.display = 'none';
                gameContent.style.display = 'block';
                initialize();
                ensureBgmPlays();
            }, 1000); 
        }

        function initialize() {
            if (growthTimerInterval) clearInterval(growthTimerInterval);
            if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
            
            updateCreatureDisplay();
            updateStatusMessage();
            timerDisplay.textContent = `ë‹¤ìŒ ì§„í™”ê¹Œì§€ ${GROWTH_INTERVAL_MS / 1000}ì´ˆ ë‚¨ìŒ`; 
            
            feedButton.style.display = 'block'; 
            cooldownDisplay.style.display = 'none';
            document.body.style.filter = 'none'; 

            startNutrientShortageTimer();
            initializeCursorParticles(); 
            
            function updateParticles() {
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    const p = particles[i];
                    p.x += (p.targetX - p.x) * 0.3; 
                    p.y += (p.targetY - p.y) * 0.3;
                    p.element.style.left = `${p.x}px`;
                    p.element.style.top = `${p.y}px`;
                    const distance = Math.sqrt(Math.pow(p.x - particles[0].targetX, 2) + Math.pow(p.y - particles[0].targetY, 2));
                    p.element.style.opacity = distance < 120 ? 0.8 : 0; 
                    p.element.style.transform = `scale(${1 - distance / 120})`; 
                }
                requestAnimationFrame(updateParticles);
            }
            requestAnimationFrame(updateParticles); 


            growthTimerInterval = setInterval(() => {
                if (isGameOver || currentStage === CREATURE_IMAGES.length - 1) {
                    clearInterval(growthTimerInterval);
                    if (nutrientShortageTimer) clearTimeout(nutrientShortageTimer);
                    
                    if (currentStage === CREATURE_IMAGES.length - 1) {
                        transitionToPetting();
                    }
                    return;
                }

                growthTimeElapsed += 1000; 
                
                const growthProgress = (growthTimeElapsed / GROWTH_INTERVAL_MS) * 100;
                growthProgressBar.style.width = `${growthProgress}%`;

                const timeLeft = (GROWTH_INTERVAL_MS - growthTimeElapsed) / 1000;
                timerDisplay.textContent = `ë‹¤ìŒ ì§„í™”ê¹Œì§€ ${timeLeft}ì´ˆ ë‚¨ìŒ`; 

                if (growthTimeElapsed >= GROWTH_INTERVAL_MS) {
                    growCreature(); 
                    growthTimeElapsed = 0; 
                }
            }, 1000); 

            if (!originalFeedListener) {
                originalFeedListener = handleFeeding;
                feedButton.addEventListener('click', originalFeedListener); 
                feedButton.addEventListener('click', ensureBgmPlays); 
                restartButton.addEventListener('click', restartGame); 
            }
            
            creatureIcon.removeEventListener('click', handlePetting);
        }

        introScreen.addEventListener('click', startGame);
    </script>
</body>
</html>